<!DOCTYPE html>
<html lang="en">
  <!-- Beautiful Jekyll | MIT license | Copyright Dean Attali 2016 -->
  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <title>Solidity 0.6.x features: try/catch statement | Ethereum Foundation Blog</title>

  <meta name="author" content="Solidity Team" />

  

  <link rel="alternate" type="application/rss+xml" title="Solidity Blog - blog.ethereum.org" href="/feed.xml" />

  

  
    
      
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" />

    
      
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.4/dist/instantsearch.min.css" />

    
      
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.4/dist/instantsearch-theme-algolia.min.css" />

    
  

  
    
      <link rel="stylesheet" href="/css/bootstrap.min.css" />
    
      <link rel="stylesheet" href="/css/bootstrap-social.css" />
    
      <link rel="stylesheet" href="/css/main.css" />
    
      <link rel="stylesheet" href="/css/search.css" />
    
  

  
    
      <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
    
      <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" />
    
  

  

  

  

    <!-- Facebook OpenGraph tags -->
  

  
  <meta property="og:title" content="Solidity 0.6.x features: try/catch statement" />
  

   
  <meta property="og:description" content="The try/catch syntax introduced in 0.6.0 is arguably the biggest leap in error handling capabilities in Solidity, since reason strings for revert and require were released in v0.4.22. Both try and catch have been reserved keywords since v0.5.9 and now we can use them to handle failures in external function...">
  


  <meta property="og:type" content="website" />

  
  <meta property="og:url" content="http://localhost:4000/2020/01/29/solidity-0.6-try-catch/" />
  <link rel="canonical" href="http://localhost:4000/2020/01/29/solidity-0.6-try-catch/" />
  

  
  <meta property="og:image" content="http://localhost:4000/img/ethereum-blog-og-image.png" />
  


  <!-- Twitter summary cards -->
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@" />
  <meta name="twitter:creator" content="@" />

  
  <meta name="twitter:title" content="Solidity 0.6.x features: try/catch statement" />
  

  
  <meta name="twitter:description" content="The try/catch syntax introduced in 0.6.0 is arguably the biggest leap in error handling capabilities in Solidity, since reason strings for revert and require were released in v0.4.22. Both try and catch have been reserved keywords since v0.5.9 and now we can use them to handle failures in external function...">
  

  
  <meta name="twitter:image" content="http://localhost:4000/favicon.png" />
  

  

  <link rel="shortcut icon" type="image/png" href="/favicon.png"/>

</head>


  <body>

    
  
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      
        <a class="navbar-brand" href="http://localhost:4000">Solidity Blog</a>
      
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
      
        
          <li>
            






<a href="https://ethereum.org/">Ethereum.org</a>

          </li>
        
        
        
          <li>
            






<a href="https://solidity.readthedocs.io/">Solidity Docs</a>

          </li>
        
        
      </ul>
    </div>

	
	<div class="avatar-container">
	  <div class="avatar-img-border">
	    <a href="http://localhost:4000 ">
	      <img class="avatar-img" src="/img/avatar-icon.svg" />
		</a>
	  </div>
	</div>
	

  </div>
</nav>


    <!-- TODO this file has become a mess, refactor it -->



  

  <header class="header-section ">
  

  <div class="intro-header no-img">
    <div class="container">
      <div class="row">
        <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
          <div class="post-heading">
            <h1>Solidity 0.6.x features: try/catch statement</h1>
            
        
            
              <span class="post-meta">Posted by Elena Gesheva on January 29, 2020</span>
              <ul class="post-category-list">
                
                <li>
                  <a
                    href="/category/research-and-development/"
                    class="category-research-and-development">
                    Research & Development
                  </a>
                </li>
                
              </ul>
            
          </div>
        </div>
      </div>
    </div>
  </div>
  </header>




<div class="container">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">

      

      <article role="main" class="blog-post">
        <p><img src="https://solidity.readthedocs.io/en/v0.6.2/_images/logo.svg" width="200px" alt="Solidity" /></p>

<p>The <a href="https://solidity.readthedocs.io/en/latest/control-structures.html#try-catch">try/catch syntax introduced in 0.6.0</a> is arguably the biggest leap in error handling capabilities in Solidity, since reason strings for <code class="highlighter-rouge">revert</code> and <code class="highlighter-rouge">require</code> were released in v0.4.22. Both <code class="highlighter-rouge">try</code> and <code class="highlighter-rouge">catch</code> have been reserved keywords <a href="https://solidity.readthedocs.io/en/v0.5.9/miscellaneous.html#reserved-keywords">since v0.5.9</a> and now we can use them to handle failures in <code class="highlighter-rouge">external</code> function calls without rolling back the complete transaction (state changes in the called function are still rolled back, but the ones in the calling function are not).</p>

<p>We are moving one step away from the purist “all-or-nothing” approach in a transaction lifecycle, which falls short of practical behaviour we often want.</p>

<h2 id="handling-external-call-failures">Handling external call failures</h2>

<p>The try/catch statement allows you to react on failed <em>external</em> calls and <em>contract creation</em> calls, so you cannot use it for <em>internal</em> function calls. Note that to wrap a public function call within the same contract with try/catch, it can be made external by calling the function with <code class="highlighter-rouge">this.</code>.</p>

<p>The example below demonstrates how try/catch is used in a factory pattern where contract creation might fail. The following <code class="highlighter-rouge">CharitySplitter</code> contract requires a mandatory address property <code class="highlighter-rouge">_owner</code> in its constructor.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>pragma solidity ^0.6.1;

contract CharitySplitter {
    address public owner;
    constructor (address _owner) public {
        require(_owner != address(0), "no-owner-provided");
        owner = _owner;
    }
}
</code></pre>
</div>

<p>There is a factory contract — <code class="highlighter-rouge">CharitySplitterFactory</code> which is used to create and manage instances of <code class="highlighter-rouge">CharitySplitter</code>. In the factory we can wrap the <code class="highlighter-rouge">new CharitySplitter(charityOwner)</code> in a try/catch as a failsafe for when that constructor might fail because of an empty <code class="highlighter-rouge">charityOwner</code> being passed.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>pragma solidity ^0.6.1;
import "./CharitySplitter.sol";
contract CharitySplitterFactory {
    mapping (address =&gt; CharitySplitter) public charitySplitters;
    uint public errorCount;
    event ErrorHandled(string reason);
    event ErrorNotHandled(bytes reason);
    function createCharitySplitter(address charityOwner) public {
        try new CharitySplitter(charityOwner)
            returns (CharitySplitter newCharitySplitter) 
        {
            charitySplitters[msg.sender] = newCharitySplitter;
        } catch {
            errorCount++;
        }
    }
}
</code></pre>
</div>

<p>Note that with try/catch, only exceptions happening inside the external call itself are caught. Errors inside the expression are not caught, for example if the input parameter for the <code class="highlighter-rouge">new CharitySplitter</code> is itself part of an internal call, any errors it raises will not be caught. Sample demonstrating this behaviour is the modified <code class="highlighter-rouge">createCharitySplitter</code> function. Here the <code class="highlighter-rouge">CharitySplitter</code> constructor input parameter is retrieved dynamically from another function — <code class="highlighter-rouge">getCharityOwner</code>. If that function reverts, in this example with <code class="highlighter-rouge">"revert-required-for-testing"</code>, that will not be caught in the try/catch statement.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>function createCharitySplitter(address _charityOwner) public {
    try new CharitySplitter(getCharityOwner(_charityOwner, false))
        returns (CharitySplitter newCharitySplitter)
    {
        charitySplitters[msg.sender] = newCharitySplitter;
    } catch (bytes memory reason) {
        ...
    }
}
function getCharityOwner(address _charityOwner, bool _toPass)
        internal returns (address) {
    require(_toPass, "revert-required-for-testing");
    return _charityOwner;
}
</code></pre>
</div>

<h2 id="retrieving-the-error-message">Retrieving the error message</h2>

<p>We can further extend the try/catch logic in the <code class="highlighter-rouge">createCharitySplitter</code> function to retrieve the error message if one was emitted by a failing <code class="highlighter-rouge">revert</code> or <code class="highlighter-rouge">require</code> and emit it in an event. There are two ways to achieve this:</p>

<h3 id="1-using-catch-errorstring-memory-reason">1. Using <code class="highlighter-rouge">catch Error(string memory reason)</code></h3>

<div class="highlighter-rouge"><pre class="highlight"><code>function createCharitySplitter(address _charityOwner) public {
    try new CharitySplitter(_charityOwner) returns (CharitySplitter newCharitySplitter) 
    { 
        charitySplitters[msg.sender] = newCharitySplitter;
    }
    catch Error(string memory reason) 
    {
        errorCount++;
        CharitySplitter newCharitySplitter = new
            CharitySplitter(msg.sender);
        charitySplitters[msg.sender] = newCharitySplitter;
        // Emitting the error in event
        emit ErrorHandled(reason);
    }
    catch 
    {
        errorCount++;
    }
}
</code></pre>
</div>

<p>Which emits the following event on a failed constructor require error:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>CharitySplitterFactory.ErrorHandled(
    reason: 'no-owner-provided' (type: string)
)
</code></pre>
</div>

<h3 id="2-using-catch-bytes-memory-reason">2. Using <code class="highlighter-rouge">catch (bytes memory reason)</code></h3>

<div class="highlighter-rouge"><pre class="highlight"><code>function createCharitySplitter(address charityOwner) public {
    try new CharitySplitter(charityOwner)
        returns (CharitySplitter newCharitySplitter) 
    {
        charitySplitters[msg.sender] = newCharitySplitter;
    } 
    catch (bytes memory reason) {
        errorCount++;
        emit ErrorNotHandled(reason);
    }
}
</code></pre>
</div>

<p>Which emits the following event on a failed constructor require error:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>CharitySplitterFactory.ErrorNotHandled(
  reason: hex'08c379a0000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000116e6f2d6f776e65722d70726f7669646564000000000000000000000000000000' (type: bytes)
</code></pre>
</div>

<p>The above two methods for retrieving the error string produce a similar result. The difference is that the second method does not ABI-decode the error string. The advantage of the second method is that it is also executed if ABI decoding the error string fails or if no reason was provided.</p>

<h2 id="future-plans">Future plans</h2>

<p>There are plans to release support for error types meaning we will be able to declare errors in a similar way to events allowing us to catch different type of errors, for example:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>catch CustomErrorA(uint data1) { … }
catch CustomErrorB(uint[] memory data2) { … }
catch {}
</code></pre>
</div>

      </article>

      

      
        <!-- Check if any share-links are active -->





      

      <ul class="pager blog-pager">
        
        <li class="previous">
          <a href="/2019/06/25/solidity-storage-array-bugs/" data-toggle="tooltip" data-placement="top" title="Solidity Storage Array Bugs">&larr; Previous Post</a>
        </li>
        
        
      </ul>

      
        <div class="disqus-comments">
          
        </div>
      
    </div>
  </div>
</div>


    <footer>
  <div class="container beautiful-jekyll-footer">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links"><li><a href="/feed.xml" title="RSS"><span class="fa-stack fa-lg" aria-hidden="true">
                  <i class="fa fa-circle fa-stack-2x"></i>
                  <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                </span>
                <span class="sr-only">RSS</span>
              </a>
            </li><li><a href="mailto:solidity@ethereum.org" title="Email me"><span class="fa-stack fa-lg" aria-hidden="true">
                  <i class="fa fa-circle fa-stack-2x"></i>
                  <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
                </span>
                <span class="sr-only">Email me</span>
              </a>
            </li><li><a href="https://www.facebook.com/ethereumproject" title="Facebook"><span class="fa-stack fa-lg" aria-hidden="true">
                  <i class="fa fa-circle fa-stack-2x"></i>
                  <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
                </span>
                <span class="sr-only">Facebook</span>
              </a>
            </li><li><a href="https://github.com/ethereum" title="GitHub"><span class="fa-stack fa-lg" aria-hidden="true">
                  <i class="fa fa-circle fa-stack-2x"></i>
                  <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                </span>
                <span class="sr-only">GitHub</span>
              </a>
            </li><li><a href="https://twitter.com/solidity_lang" title="Twitter"><span class="fa-stack fa-lg" aria-hidden="true">
                  <i class="fa fa-circle fa-stack-2x"></i>
                  <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                </span>
                <span class="sr-only">Twitter</span>
              </a>
            </li><li><a href="https://stackoverflow.com/users/https://ethereum.stackexchange.com/questions/tagged/solidity" title="StackOverflow"><span class="fa-stack fa-lg" aria-hidden="true">
                  <i class="fa fa-circle fa-stack-2x"></i>
                  <i class="fa fa-stack-overflow fa-stack-1x fa-inverse"></i>
                </span>
                <span class="sr-only">StackOverflow</span>
              </a>
            </li></ul>
      <p class="copyright text-muted">
        Solidity Team
        &nbsp;&bull;&nbsp;
        2020

        
        &nbsp;&bull;&nbsp;
        <a href="http://localhost:4000">blog.ethereum.org</a>
        

        &nbsp;&bull;&nbsp;
        <a href="/archive/">Blog Archive</a>

        
        
      </p>
        <!-- Please don't remove this, keep my open source work credited :) -->
        <p class="theme-by text-muted">
          Theme by
          <a href="http://deanattali.com/beautiful-jekyll/">beautiful-jekyll</a>
        </p>
      </div>
    </div>
  </div>
</footer>

  
    
  
    
  <script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.4"></script>


  







  
    
    
      <script>
      	if (typeof jQuery == 'undefined') {
      	  document.write('<script src="/js/jquery-1.11.2.min.js"></scr' + 'ipt>');
      	}
      </script>
    
  
    
    
	<script src="/js/bootstrap.min.js"></script>
    
  
    
    
	<script src="/js/main.js"></script>
    
  



<script>
    function injectProperties(item) {
        if (item.categories) {
            item.categoriesMap = item.categories.map(e => {
                return {
                    name: e,
                    slug: e.replace('&', 'and').replace(/\s+/g, '-').toLowerCase()
                }
            })
        }

        if (item.date) {
            item.dateFormatted = new Date(item.date * 1000).toLocaleDateString()
        }
        console.log(item);
        
        return item
    };

    const search = instantsearch({
        appId: 'DTH6Q9FCM4',
        apiKey: '',
        indexName: '',
        routing: true
    });

    // initialize SearchBox
    search.addWidget(
        instantsearch.widgets.searchBox({
            container: '#search-box',
            placeholder: 'Search for posts'
        })
    );

    // initialize RefinementList
    search.addWidget(
        instantsearch.widgets.refinementList({
            container: '#search-refinement-list',
            attributeName: 'categories'
        })
    );    
    
    // initialize currentRefinedValues
    search.addWidget(
        instantsearch.widgets.currentRefinedValues({
        container: '#search-current-refined-values'
        })
    );

    // initialize pagination
    search.addWidget(
        instantsearch.widgets.pagination({
        container: '#search-pagination',
        maxPages: 20,
        })
    );

    
    // initialize hits widget
    search.addWidget(
        instantsearch.widgets.hits({
            // transformItems: c => {console.log(c); return c },
            transformItems: c => c.map(e => injectProperties(e)),
            container: '#search-hits',
            templates: {
                empty: 'No results',
                item: `
                    <h2><a href="{{url}}">{{{_highlightResult.title.value}}}</a></h2>
                    <p>{{{_highlightResult.content.value}}}</p>
                    <p class="post-meta">
                        {{#categoriesMap}}
                            <a href="/category/{{slug}}.html" class="category-{{slug}}">{{name}}</a>
                        {{/categoriesMap}}
                        {{#author}}
                            <span><i class="fa fa-user-o" aria-hidden="true"></i> {{author}}</span>
                        {{/author}}
                        {{#dateFormatted}}
                            <span><i class="fa fa-calendar-o"></i> {{dateFormatted}}</span>
                        {{/dateFormatted}}
                    </p>
                `
            }
        })
    );
    
    search.start();
</script>

  
  </body>
</html>
